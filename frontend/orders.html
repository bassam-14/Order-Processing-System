<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Orders</title>
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/orders.css">
</head>
<body>

<header class="topbar">
    <h1>My Order History</h1>
    <a href="customer.html" class="logout">Back</a>
</header>

<main class="orders-container">

    <div class="orders-card">
        <h2>Past Orders</h2>
        <p class="subtitle">Track the status of your recent purchases.</p>

        <table class="orders-table">
            <thead>
            <tr>
                <th>Order ID</th>
                <th>Date Placed</th>
                <th>Total Price</th>
                <th>Status</th>
            </tr>
            </thead>
            <tbody id="orders-list">
                </tbody>
        </table>
    </div>

</main>

<script>
    window.onload = async function() {
        const user = JSON.parse(localStorage.getItem('currentUser'));
        if (!user) { window.location.href = 'login.html'; return; }

        try {
            const response = await fetch(`http://localhost:8080/api/orders/user/${user.id}`);
            const myOrders = await response.json();

            const tableBody = document.getElementById('orders-list');
            let html = '';

            myOrders.forEach(order => {
                const dateStr = new Date(order.orderDate).toLocaleDateString();
                
                html += `
                    <tr>
                        <td class="id-col">#${order.id}</td>
                        <td>${dateStr}</td>
                        <td class="price-col">$${order.totalPrice.toFixed(2)}</td>
                        <td><span class="badge success">Confirmed</span></td>
                    </tr>
                `;
            });
            tableBody.innerHTML = html;
        } catch (error) {
            console.error("Error loading orders:", error);
            document.getElementById('orders-list').innerHTML = "<tr><td colspan='4'>Failed to load orders.</td></tr>";
        }
    };
</script>

</body>
</html>