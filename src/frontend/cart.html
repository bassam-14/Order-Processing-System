<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shopping Cart</title>
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/cart.css">
</head>
<body>

<header class="topbar">
    <h1>My Cart</h1>
    <a href="customer.html" class="logout">Back</a>
</header>

<main class="cart-container">

    <table class="cart-table">
        <thead>
        <tr>
            <th>Book</th>
            <th>Author</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Total</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody id="cart-items">
        <tr class="cart-row">
            <td>Clean Code</td>
            <td>Robert C. Martin</td>
            <td class="price" data-price="30">$30.00</td>
            <td>
                <input type="number" value="1" min="1" class="qty-input" 
                       onchange="if(this.value < 1) this.value = 1;"
                       oninput="updateCart()">
            </td>
            <td class="item-total">$30.00</td>
            <td><a href="#" class="remove-btn" onclick="removeItem(this)">Remove</a></td>
        </tr>

        <tr class="cart-row">
            <td>Design Patterns</td>
            <td>GoF</td>
            <td class="price" data-price="45">$45.00</td>
            <td>
                <input type="number" value="2" min="1" class="qty-input"
                       onchange="if(this.value < 1) this.value = 1;"
                       oninput="updateCart()">
            </td>
            <td class="item-total">$90.00</td>
            <td><a href="#" class="remove-btn" onclick="removeItem(this)">Remove</a></td>
        </tr>
        </tbody>
    </table>

    <div class="cart-summary">
        <div class="totals">
            <p><strong>Total Items:</strong> <span id="summary-items">3</span></p>
            <p class="total-price"><strong>Total Price:</strong> <span id="summary-total">$120.00</span></p>
        </div>
        <a href="checkout.html" class="action">Checkout</a>
    </div>

</main>

<script>
    // Runs whenever a user changes a quantity
    function updateCart() {
        let totalItems = 0;
        let totalPrice = 0;
        
        // Loop through every row in the cart
        const rows = document.querySelectorAll('.cart-row');
        
        rows.forEach(row => {
            // Get the price from the data attribute (e.g., 30)
            const price = parseFloat(row.querySelector('.price').dataset.price);
            // Get the current quantity value
            const qtyInput = row.querySelector('.qty-input');
            let qty = parseInt(qtyInput.value);
            
            // Safety check: if empty or invalid, treat as 0
            if (isNaN(qty) || qty < 1) qty = 1;

            // Math: Price * Quantity
            const rowTotal = price * qty;

            // Update the "Total" column for this specific book
            row.querySelector('.item-total').innerText = '$' + rowTotal.toFixed(2);

            // Add to the global totals
            totalItems += qty;
            totalPrice += rowTotal;
        });

        // Update the Bottom Summary
        document.getElementById('summary-items').innerText = totalItems;
        document.getElementById('summary-total').innerText = '$' + totalPrice.toFixed(2);
    }

    // Optional: Remove item visual logic
    function removeItem(element) {
        // Removes the row from the table
        element.closest('tr').remove();
        // Recalculate totals immediately
        updateCart();
    }
</script>

</body>
</html>